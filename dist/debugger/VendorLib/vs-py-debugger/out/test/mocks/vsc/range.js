/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:all

const position_1 = require("./position");

var vscMockRange;

(function (vscMockRange) {
  /**
   * A range in the editor. (startLineNumber,startColumn) is <= (endLineNumber,endColumn)
   */
  class Range {
    constructor(startLineNumber, startColumn, endLineNumber, endColumn) {
      if (startLineNumber > endLineNumber || startLineNumber === endLineNumber && startColumn > endColumn) {
        this.startLineNumber = endLineNumber;
        this.startColumn = endColumn;
        this.endLineNumber = startLineNumber;
        this.endColumn = startColumn;
      } else {
        this.startLineNumber = startLineNumber;
        this.startColumn = startColumn;
        this.endLineNumber = endLineNumber;
        this.endColumn = endColumn;
      }
    }
    /**
     * Test if this range is empty.
     */


    isEmpty() {
      return Range.isEmpty(this);
    }
    /**
     * Test if `range` is empty.
     */


    static isEmpty(range) {
      return range.startLineNumber === range.endLineNumber && range.startColumn === range.endColumn;
    }
    /**
     * Test if position is in this range. If the position is at the edges, will return true.
     */


    containsPosition(position) {
      return Range.containsPosition(this, position);
    }
    /**
     * Test if `position` is in `range`. If the position is at the edges, will return true.
     */


    static containsPosition(range, position) {
      if (position.lineNumber < range.startLineNumber || position.lineNumber > range.endLineNumber) {
        return false;
      }

      if (position.lineNumber === range.startLineNumber && position.column < range.startColumn) {
        return false;
      }

      if (position.lineNumber === range.endLineNumber && position.column > range.endColumn) {
        return false;
      }

      return true;
    }
    /**
     * Test if range is in this range. If the range is equal to this range, will return true.
     */


    containsRange(range) {
      return Range.containsRange(this, range);
    }
    /**
     * Test if `otherRange` is in `range`. If the ranges are equal, will return true.
     */


    static containsRange(range, otherRange) {
      if (otherRange.startLineNumber < range.startLineNumber || otherRange.endLineNumber < range.startLineNumber) {
        return false;
      }

      if (otherRange.startLineNumber > range.endLineNumber || otherRange.endLineNumber > range.endLineNumber) {
        return false;
      }

      if (otherRange.startLineNumber === range.startLineNumber && otherRange.startColumn < range.startColumn) {
        return false;
      }

      if (otherRange.endLineNumber === range.endLineNumber && otherRange.endColumn > range.endColumn) {
        return false;
      }

      return true;
    }
    /**
     * A reunion of the two ranges.
     * The smallest position will be used as the start point, and the largest one as the end point.
     */


    plusRange(range) {
      return Range.plusRange(this, range);
    }
    /**
     * A reunion of the two ranges.
     * The smallest position will be used as the start point, and the largest one as the end point.
     */


    static plusRange(a, b) {
      var startLineNumber, startColumn, endLineNumber, endColumn;

      if (b.startLineNumber < a.startLineNumber) {
        startLineNumber = b.startLineNumber;
        startColumn = b.startColumn;
      } else if (b.startLineNumber === a.startLineNumber) {
        startLineNumber = b.startLineNumber;
        startColumn = Math.min(b.startColumn, a.startColumn);
      } else {
        startLineNumber = a.startLineNumber;
        startColumn = a.startColumn;
      }

      if (b.endLineNumber > a.endLineNumber) {
        endLineNumber = b.endLineNumber;
        endColumn = b.endColumn;
      } else if (b.endLineNumber === a.endLineNumber) {
        endLineNumber = b.endLineNumber;
        endColumn = Math.max(b.endColumn, a.endColumn);
      } else {
        endLineNumber = a.endLineNumber;
        endColumn = a.endColumn;
      }

      return new Range(startLineNumber, startColumn, endLineNumber, endColumn);
    }
    /**
     * A intersection of the two ranges.
     */


    intersectRanges(range) {
      return Range.intersectRanges(this, range);
    }
    /**
     * A intersection of the two ranges.
     */


    static intersectRanges(a, b) {
      var resultStartLineNumber = a.startLineNumber,
          resultStartColumn = a.startColumn,
          resultEndLineNumber = a.endLineNumber,
          resultEndColumn = a.endColumn,
          otherStartLineNumber = b.startLineNumber,
          otherStartColumn = b.startColumn,
          otherEndLineNumber = b.endLineNumber,
          otherEndColumn = b.endColumn;

      if (resultStartLineNumber < otherStartLineNumber) {
        resultStartLineNumber = otherStartLineNumber;
        resultStartColumn = otherStartColumn;
      } else if (resultStartLineNumber === otherStartLineNumber) {
        resultStartColumn = Math.max(resultStartColumn, otherStartColumn);
      }

      if (resultEndLineNumber > otherEndLineNumber) {
        resultEndLineNumber = otherEndLineNumber;
        resultEndColumn = otherEndColumn;
      } else if (resultEndLineNumber === otherEndLineNumber) {
        resultEndColumn = Math.min(resultEndColumn, otherEndColumn);
      } // Check if selection is now empty


      if (resultStartLineNumber > resultEndLineNumber) {
        return null;
      }

      if (resultStartLineNumber === resultEndLineNumber && resultStartColumn > resultEndColumn) {
        return null;
      }

      return new Range(resultStartLineNumber, resultStartColumn, resultEndLineNumber, resultEndColumn);
    }
    /**
     * Test if this range equals other.
     */


    equalsRange(other) {
      return Range.equalsRange(this, other);
    }
    /**
     * Test if range `a` equals `b`.
     */


    static equalsRange(a, b) {
      return !!a && !!b && a.startLineNumber === b.startLineNumber && a.startColumn === b.startColumn && a.endLineNumber === b.endLineNumber && a.endColumn === b.endColumn;
    }
    /**
     * Return the end position (which will be after or equal to the start position)
     */


    getEndPosition() {
      return new position_1.vscMockPosition.Position(this.endLineNumber, this.endColumn);
    }
    /**
     * Return the start position (which will be before or equal to the end position)
     */


    getStartPosition() {
      return new position_1.vscMockPosition.Position(this.startLineNumber, this.startColumn);
    }
    /**
     * Transform to a user presentable string representation.
     */


    toString() {
      return '[' + this.startLineNumber + ',' + this.startColumn + ' -> ' + this.endLineNumber + ',' + this.endColumn + ']';
    }
    /**
     * Create a new range using this range's start position, and using endLineNumber and endColumn as the end position.
     */


    setEndPosition(endLineNumber, endColumn) {
      return new Range(this.startLineNumber, this.startColumn, endLineNumber, endColumn);
    }
    /**
     * Create a new range using this range's end position, and using startLineNumber and startColumn as the start position.
     */


    setStartPosition(startLineNumber, startColumn) {
      return new Range(startLineNumber, startColumn, this.endLineNumber, this.endColumn);
    }
    /**
     * Create a new empty range using this range's start position.
     */


    collapseToStart() {
      return Range.collapseToStart(this);
    }
    /**
     * Create a new empty range using this range's start position.
     */


    static collapseToStart(range) {
      return new Range(range.startLineNumber, range.startColumn, range.startLineNumber, range.startColumn);
    } // ---


    static fromPositions(start, end = start) {
      return new Range(start.lineNumber, start.column, end.lineNumber, end.column);
    }
    /**
     * Create a `Range` from an `IRange`.
     */


    static lift(range) {
      if (!range) {
        return null;
      }

      return new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);
    }
    /**
     * Test if `obj` is an `IRange`.
     */


    static isIRange(obj) {
      return obj && typeof obj.startLineNumber === 'number' && typeof obj.startColumn === 'number' && typeof obj.endLineNumber === 'number' && typeof obj.endColumn === 'number';
    }
    /**
     * Test if the two ranges are touching in any way.
     */


    static areIntersectingOrTouching(a, b) {
      // Check if `a` is before `b`
      if (a.endLineNumber < b.startLineNumber || a.endLineNumber === b.startLineNumber && a.endColumn < b.startColumn) {
        return false;
      } // Check if `b` is before `a`


      if (b.endLineNumber < a.startLineNumber || b.endLineNumber === a.startLineNumber && b.endColumn < a.startColumn) {
        return false;
      } // These ranges must intersect


      return true;
    }
    /**
     * A function that compares ranges, useful for sorting ranges
     * It will first compare ranges on the startPosition and then on the endPosition
     */


    static compareRangesUsingStarts(a, b) {
      let aStartLineNumber = a.startLineNumber | 0;
      let bStartLineNumber = b.startLineNumber | 0;

      if (aStartLineNumber === bStartLineNumber) {
        let aStartColumn = a.startColumn | 0;
        let bStartColumn = b.startColumn | 0;

        if (aStartColumn === bStartColumn) {
          let aEndLineNumber = a.endLineNumber | 0;
          let bEndLineNumber = b.endLineNumber | 0;

          if (aEndLineNumber === bEndLineNumber) {
            let aEndColumn = a.endColumn | 0;
            let bEndColumn = b.endColumn | 0;
            return aEndColumn - bEndColumn;
          }

          return aEndLineNumber - bEndLineNumber;
        }

        return aStartColumn - bStartColumn;
      }

      return aStartLineNumber - bStartLineNumber;
    }
    /**
     * A function that compares ranges, useful for sorting ranges
     * It will first compare ranges on the endPosition and then on the startPosition
     */


    static compareRangesUsingEnds(a, b) {
      if (a.endLineNumber === b.endLineNumber) {
        if (a.endColumn === b.endColumn) {
          if (a.startLineNumber === b.startLineNumber) {
            return a.startColumn - b.startColumn;
          }

          return a.startLineNumber - b.startLineNumber;
        }

        return a.endColumn - b.endColumn;
      }

      return a.endLineNumber - b.endLineNumber;
    }
    /**
     * Test if the range spans multiple lines.
     */


    static spansMultipleLines(range) {
      return range.endLineNumber > range.startLineNumber;
    }

  }

  vscMockRange.Range = Range;
})(vscMockRange = exports.vscMockRange || (exports.vscMockRange = {}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJhbmdlLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwicG9zaXRpb25fMSIsInJlcXVpcmUiLCJ2c2NNb2NrUmFuZ2UiLCJSYW5nZSIsImNvbnN0cnVjdG9yIiwic3RhcnRMaW5lTnVtYmVyIiwic3RhcnRDb2x1bW4iLCJlbmRMaW5lTnVtYmVyIiwiZW5kQ29sdW1uIiwiaXNFbXB0eSIsInJhbmdlIiwiY29udGFpbnNQb3NpdGlvbiIsInBvc2l0aW9uIiwibGluZU51bWJlciIsImNvbHVtbiIsImNvbnRhaW5zUmFuZ2UiLCJvdGhlclJhbmdlIiwicGx1c1JhbmdlIiwiYSIsImIiLCJNYXRoIiwibWluIiwibWF4IiwiaW50ZXJzZWN0UmFuZ2VzIiwicmVzdWx0U3RhcnRMaW5lTnVtYmVyIiwicmVzdWx0U3RhcnRDb2x1bW4iLCJyZXN1bHRFbmRMaW5lTnVtYmVyIiwicmVzdWx0RW5kQ29sdW1uIiwib3RoZXJTdGFydExpbmVOdW1iZXIiLCJvdGhlclN0YXJ0Q29sdW1uIiwib3RoZXJFbmRMaW5lTnVtYmVyIiwib3RoZXJFbmRDb2x1bW4iLCJlcXVhbHNSYW5nZSIsIm90aGVyIiwiZ2V0RW5kUG9zaXRpb24iLCJ2c2NNb2NrUG9zaXRpb24iLCJQb3NpdGlvbiIsImdldFN0YXJ0UG9zaXRpb24iLCJ0b1N0cmluZyIsInNldEVuZFBvc2l0aW9uIiwic2V0U3RhcnRQb3NpdGlvbiIsImNvbGxhcHNlVG9TdGFydCIsImZyb21Qb3NpdGlvbnMiLCJzdGFydCIsImVuZCIsImxpZnQiLCJpc0lSYW5nZSIsIm9iaiIsImFyZUludGVyc2VjdGluZ09yVG91Y2hpbmciLCJjb21wYXJlUmFuZ2VzVXNpbmdTdGFydHMiLCJhU3RhcnRMaW5lTnVtYmVyIiwiYlN0YXJ0TGluZU51bWJlciIsImFTdGFydENvbHVtbiIsImJTdGFydENvbHVtbiIsImFFbmRMaW5lTnVtYmVyIiwiYkVuZExpbmVOdW1iZXIiLCJhRW5kQ29sdW1uIiwiYkVuZENvbHVtbiIsImNvbXBhcmVSYW5nZXNVc2luZ0VuZHMiLCJzcGFuc011bHRpcGxlTGluZXMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0MsRSxDQUNBOztBQUNBLE1BQU1DLFVBQVUsR0FBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBMUI7O0FBQ0EsSUFBSUMsWUFBSjs7QUFDQSxDQUFDLFVBQVVBLFlBQVYsRUFBd0I7QUFDckI7QUFDSjtBQUNBO0FBQ0ksUUFBTUMsS0FBTixDQUFZO0FBQ1JDLElBQUFBLFdBQVcsQ0FBQ0MsZUFBRCxFQUFrQkMsV0FBbEIsRUFBK0JDLGFBQS9CLEVBQThDQyxTQUE5QyxFQUF5RDtBQUNoRSxVQUFLSCxlQUFlLEdBQUdFLGFBQW5CLElBQXNDRixlQUFlLEtBQUtFLGFBQXBCLElBQXFDRCxXQUFXLEdBQUdFLFNBQTdGLEVBQXlHO0FBQ3JHLGFBQUtILGVBQUwsR0FBdUJFLGFBQXZCO0FBQ0EsYUFBS0QsV0FBTCxHQUFtQkUsU0FBbkI7QUFDQSxhQUFLRCxhQUFMLEdBQXFCRixlQUFyQjtBQUNBLGFBQUtHLFNBQUwsR0FBaUJGLFdBQWpCO0FBQ0gsT0FMRCxNQU1LO0FBQ0QsYUFBS0QsZUFBTCxHQUF1QkEsZUFBdkI7QUFDQSxhQUFLQyxXQUFMLEdBQW1CQSxXQUFuQjtBQUNBLGFBQUtDLGFBQUwsR0FBcUJBLGFBQXJCO0FBQ0EsYUFBS0MsU0FBTCxHQUFpQkEsU0FBakI7QUFDSDtBQUNKO0FBQ0Q7QUFDUjtBQUNBOzs7QUFDUUMsSUFBQUEsT0FBTyxHQUFHO0FBQ04sYUFBT04sS0FBSyxDQUFDTSxPQUFOLENBQWMsSUFBZCxDQUFQO0FBQ0g7QUFDRDtBQUNSO0FBQ0E7OztBQUNRLFdBQU9BLE9BQVAsQ0FBZUMsS0FBZixFQUFzQjtBQUNsQixhQUFRQSxLQUFLLENBQUNMLGVBQU4s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QUFGLEtBQW9CWSxDQUFDLENBQUNaLGFBQTFCLEVBQXlDO0FBQ3JDLFlBQUlXLENBQUMsQ0FBQ1YsU0FBRixLQUFnQlcsQ0FBQyxDQUFDWCxTQUF0QixFQUFpQztBQUM3QixjQUFJVSxDQUFDLENBQUNiLGVBQUYsS0FBc0JjLENBQUMsQ0FBQ2QsZUFBNUIsRUFBNkM7QUFDekMsbUJBQU9hLENBQUMsQ0FBQ1osV0FBRixHQUFnQmEsQ0FBQyxDQUFDYixXQUF6QjtBQUNIOztBQUNELGlCQUFPWSxDQUFDLENBQUNiLGVBQUYsR0FBb0JjLENBQUMsQ0FBQ2QsZUFBN0I7QUFDSDs7QUFDRCxlQUFPYSxDQUFDLENBQUNWLFNBQUYsR0FBY1csQ0FBQyxDQUFDWCxTQUF2QjtBQUNIOztBQUNELGFBQU9VLENBQUMsQ0FBQ1gsYUFBRixHQUFrQlksQ0FBQyxDQUFDWixhQUEzQjtBQUNIO0FBQ0Q7QUFDUjtBQUNBOzs7QUFDUSxXQUFPb0Qsa0JBQVAsQ0FBMEJqRCxLQUExQixFQUFpQztBQUM3QixhQUFPQSxLQUFLLENBQUNILGFBQU4sR0FBc0JHLEtBQUssQ0FBQ0wsZUFBbkM7QUFDSDs7QUEvUk87O0FBaVNaSCxFQUFBQSxZQUFZLENBQUNDLEtBQWIsR0FBcUJBLEtBQXJCO0FBQ0gsQ0F0U0QsRUFzU0dELFlBQVksR0FBR0osT0FBTyxDQUFDSSxZQUFSLEtBQXlCSixPQUFPLENBQUNJLFlBQVIsR0FBdUIsRUFBaEQsQ0F0U2xCIiwic291cmNlc0NvbnRlbnQiOlsiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4ndXNlIHN0cmljdCc7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vLyB0c2xpbnQ6ZGlzYWJsZTphbGxcbmNvbnN0IHBvc2l0aW9uXzEgPSByZXF1aXJlKFwiLi9wb3NpdGlvblwiKTtcbnZhciB2c2NNb2NrUmFuZ2U7XG4oZnVuY3Rpb24gKHZzY01vY2tSYW5nZSkge1xuICAgIC8qKlxuICAgICAqIEEgcmFuZ2UgaW4gdGhlIGVkaXRvci4gKHN0YXJ0TGluZU51bWJlcixzdGFydENvbHVtbikgaXMgPD0gKGVuZExpbmVOdW1iZXIsZW5kQ29sdW1uKVxuICAgICAqL1xuICAgIGNsYXNzIFJhbmdlIHtcbiAgICAgICAgY29uc3RydWN0b3Ioc3RhcnRMaW5lTnVtYmVyLCBzdGFydENvbHVtbiwgZW5kTGluZU51bWJlciwgZW5kQ29sdW1uKSB7XG4gICAgICAgICAgICBpZiAoKHN0YXJ0TGluZU51bWJlciA+IGVuZExpbmVOdW1iZXIpIHx8IChzdGFydExpbmVOdW1iZXIgPT09IGVuZExpbmVOdW1iZXIgJiYgc3RhcnRDb2x1bW4gPiBlbmRDb2x1bW4pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydExpbmVOdW1iZXIgPSBlbmRMaW5lTnVtYmVyO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRDb2x1bW4gPSBlbmRDb2x1bW47XG4gICAgICAgICAgICAgICAgdGhpcy5lbmRMaW5lTnVtYmVyID0gc3RhcnRMaW5lTnVtYmVyO1xuICAgICAgICAgICAgICAgIHRoaXMuZW5kQ29sdW1uID0gc3RhcnRDb2x1bW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0TGluZU51bWJlciA9IHN0YXJ0TGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0Q29sdW1uID0gc3RhcnRDb2x1bW47XG4gICAgICAgICAgICAgICAgdGhpcy5lbmRMaW5lTnVtYmVyID0gZW5kTGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICB0aGlzLmVuZENvbHVtbiA9IGVuZENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiB0aGlzIHJhbmdlIGlzIGVtcHR5LlxuICAgICAgICAgKi9cbiAgICAgICAgaXNFbXB0eSgpIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5pc0VtcHR5KHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZXN0IGlmIGByYW5nZWAgaXMgZW1wdHkuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgaXNFbXB0eShyYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIChyYW5nZS5zdGFydExpbmVOdW1iZXIgPT09IHJhbmdlLmVuZExpbmVOdW1iZXIgJiYgcmFuZ2Uuc3RhcnRDb2x1bW4gPT09IHJhbmdlLmVuZENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRlc3QgaWYgcG9zaXRpb24gaXMgaW4gdGhpcyByYW5nZS4gSWYgdGhlIHBvc2l0aW9uIGlzIGF0IHRoZSBlZGdlcywgd2lsbCByZXR1cm4gdHJ1ZS5cbiAgICAgICAgICovXG4gICAgICAgIGNvbnRhaW5zUG9zaXRpb24ocG9zaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5jb250YWluc1Bvc2l0aW9uKHRoaXMsIHBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiBgcG9zaXRpb25gIGlzIGluIGByYW5nZWAuIElmIHRoZSBwb3NpdGlvbiBpcyBhdCB0aGUgZWRnZXMsIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgY29udGFpbnNQb3NpdGlvbihyYW5nZSwgcG9zaXRpb24pIHtcbiAgICAgICAgICAgIGlmIChwb3NpdGlvbi5saW5lTnVtYmVyIDwgcmFuZ2Uuc3RhcnRMaW5lTnVtYmVyIHx8IHBvc2l0aW9uLmxpbmVOdW1iZXIgPiByYW5nZS5lbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBvc2l0aW9uLmxpbmVOdW1iZXIgPT09IHJhbmdlLnN0YXJ0TGluZU51bWJlciAmJiBwb3NpdGlvbi5jb2x1bW4gPCByYW5nZS5zdGFydENvbHVtbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3NpdGlvbi5saW5lTnVtYmVyID09PSByYW5nZS5lbmRMaW5lTnVtYmVyICYmIHBvc2l0aW9uLmNvbHVtbiA+IHJhbmdlLmVuZENvbHVtbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZXN0IGlmIHJhbmdlIGlzIGluIHRoaXMgcmFuZ2UuIElmIHRoZSByYW5nZSBpcyBlcXVhbCB0byB0aGlzIHJhbmdlLCB3aWxsIHJldHVybiB0cnVlLlxuICAgICAgICAgKi9cbiAgICAgICAgY29udGFpbnNSYW5nZShyYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIFJhbmdlLmNvbnRhaW5zUmFuZ2UodGhpcywgcmFuZ2UpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZXN0IGlmIGBvdGhlclJhbmdlYCBpcyBpbiBgcmFuZ2VgLiBJZiB0aGUgcmFuZ2VzIGFyZSBlcXVhbCwgd2lsbCByZXR1cm4gdHJ1ZS5cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBjb250YWluc1JhbmdlKHJhbmdlLCBvdGhlclJhbmdlKSB7XG4gICAgICAgICAgICBpZiAob3RoZXJSYW5nZS5zdGFydExpbmVOdW1iZXIgPCByYW5nZS5zdGFydExpbmVOdW1iZXIgfHwgb3RoZXJSYW5nZS5lbmRMaW5lTnVtYmVyIDwgcmFuZ2Uuc3RhcnRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG90aGVyUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyID4gcmFuZ2UuZW5kTGluZU51bWJlciB8fCBvdGhlclJhbmdlLmVuZExpbmVOdW1iZXIgPiByYW5nZS5lbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG90aGVyUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyID09PSByYW5nZS5zdGFydExpbmVOdW1iZXIgJiYgb3RoZXJSYW5nZS5zdGFydENvbHVtbiA8IHJhbmdlLnN0YXJ0Q29sdW1uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG90aGVyUmFuZ2UuZW5kTGluZU51bWJlciA9PT0gcmFuZ2UuZW5kTGluZU51bWJlciAmJiBvdGhlclJhbmdlLmVuZENvbHVtbiA+IHJhbmdlLmVuZENvbHVtbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHJldW5pb24gb2YgdGhlIHR3byByYW5nZXMuXG4gICAgICAgICAqIFRoZSBzbWFsbGVzdCBwb3NpdGlvbiB3aWxsIGJlIHVzZWQgYXMgdGhlIHN0YXJ0IHBvaW50LCBhbmQgdGhlIGxhcmdlc3Qgb25lIGFzIHRoZSBlbmQgcG9pbnQuXG4gICAgICAgICAqL1xuICAgICAgICBwbHVzUmFuZ2UocmFuZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5wbHVzUmFuZ2UodGhpcywgcmFuZ2UpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHJldW5pb24gb2YgdGhlIHR3byByYW5nZXMuXG4gICAgICAgICAqIFRoZSBzbWFsbGVzdCBwb3NpdGlvbiB3aWxsIGJlIHVzZWQgYXMgdGhlIHN0YXJ0IHBvaW50LCBhbmQgdGhlIGxhcmdlc3Qgb25lIGFzIHRoZSBlbmQgcG9pbnQuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgcGx1c1JhbmdlKGEsIGIpIHtcbiAgICAgICAgICAgIHZhciBzdGFydExpbmVOdW1iZXIsIHN0YXJ0Q29sdW1uLCBlbmRMaW5lTnVtYmVyLCBlbmRDb2x1bW47XG4gICAgICAgICAgICBpZiAoYi5zdGFydExpbmVOdW1iZXIgPCBhLnN0YXJ0TGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHN0YXJ0TGluZU51bWJlciA9IGIuc3RhcnRMaW5lTnVtYmVyO1xuICAgICAgICAgICAgICAgIHN0YXJ0Q29sdW1uID0gYi5zdGFydENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGIuc3RhcnRMaW5lTnVtYmVyID09PSBhLnN0YXJ0TGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHN0YXJ0TGluZU51bWJlciA9IGIuc3RhcnRMaW5lTnVtYmVyO1xuICAgICAgICAgICAgICAgIHN0YXJ0Q29sdW1uID0gTWF0aC5taW4oYi5zdGFydENvbHVtbiwgYS5zdGFydENvbHVtbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdGFydExpbmVOdW1iZXIgPSBhLnN0YXJ0TGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICBzdGFydENvbHVtbiA9IGEuc3RhcnRDb2x1bW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYi5lbmRMaW5lTnVtYmVyID4gYS5lbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgZW5kTGluZU51bWJlciA9IGIuZW5kTGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICBlbmRDb2x1bW4gPSBiLmVuZENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGIuZW5kTGluZU51bWJlciA9PT0gYS5lbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgZW5kTGluZU51bWJlciA9IGIuZW5kTGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICBlbmRDb2x1bW4gPSBNYXRoLm1heChiLmVuZENvbHVtbiwgYS5lbmRDb2x1bW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZW5kTGluZU51bWJlciA9IGEuZW5kTGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICBlbmRDb2x1bW4gPSBhLmVuZENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2Uoc3RhcnRMaW5lTnVtYmVyLCBzdGFydENvbHVtbiwgZW5kTGluZU51bWJlciwgZW5kQ29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQSBpbnRlcnNlY3Rpb24gb2YgdGhlIHR3byByYW5nZXMuXG4gICAgICAgICAqL1xuICAgICAgICBpbnRlcnNlY3RSYW5nZXMocmFuZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5pbnRlcnNlY3RSYW5nZXModGhpcywgcmFuZ2UpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGludGVyc2VjdGlvbiBvZiB0aGUgdHdvIHJhbmdlcy5cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBpbnRlcnNlY3RSYW5nZXMoYSwgYikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdFN0YXJ0TGluZU51bWJlciA9IGEuc3RhcnRMaW5lTnVtYmVyLCByZXN1bHRTdGFydENvbHVtbiA9IGEuc3RhcnRDb2x1bW4sIHJlc3VsdEVuZExpbmVOdW1iZXIgPSBhLmVuZExpbmVOdW1iZXIsIHJlc3VsdEVuZENvbHVtbiA9IGEuZW5kQ29sdW1uLCBvdGhlclN0YXJ0TGluZU51bWJlciA9IGIuc3RhcnRMaW5lTnVtYmVyLCBvdGhlclN0YXJ0Q29sdW1uID0gYi5zdGFydENvbHVtbiwgb3RoZXJFbmRMaW5lTnVtYmVyID0gYi5lbmRMaW5lTnVtYmVyLCBvdGhlckVuZENvbHVtbiA9IGIuZW5kQ29sdW1uO1xuICAgICAgICAgICAgaWYgKHJlc3VsdFN0YXJ0TGluZU51bWJlciA8IG90aGVyU3RhcnRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0U3RhcnRMaW5lTnVtYmVyID0gb3RoZXJTdGFydExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgcmVzdWx0U3RhcnRDb2x1bW4gPSBvdGhlclN0YXJ0Q29sdW1uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0U3RhcnRMaW5lTnVtYmVyID09PSBvdGhlclN0YXJ0TGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHJlc3VsdFN0YXJ0Q29sdW1uID0gTWF0aC5tYXgocmVzdWx0U3RhcnRDb2x1bW4sIG90aGVyU3RhcnRDb2x1bW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdEVuZExpbmVOdW1iZXIgPiBvdGhlckVuZExpbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRFbmRMaW5lTnVtYmVyID0gb3RoZXJFbmRMaW5lTnVtYmVyO1xuICAgICAgICAgICAgICAgIHJlc3VsdEVuZENvbHVtbiA9IG90aGVyRW5kQ29sdW1uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0RW5kTGluZU51bWJlciA9PT0gb3RoZXJFbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0RW5kQ29sdW1uID0gTWF0aC5taW4ocmVzdWx0RW5kQ29sdW1uLCBvdGhlckVuZENvbHVtbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBzZWxlY3Rpb24gaXMgbm93IGVtcHR5XG4gICAgICAgICAgICBpZiAocmVzdWx0U3RhcnRMaW5lTnVtYmVyID4gcmVzdWx0RW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdFN0YXJ0TGluZU51bWJlciA9PT0gcmVzdWx0RW5kTGluZU51bWJlciAmJiByZXN1bHRTdGFydENvbHVtbiA+IHJlc3VsdEVuZENvbHVtbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShyZXN1bHRTdGFydExpbmVOdW1iZXIsIHJlc3VsdFN0YXJ0Q29sdW1uLCByZXN1bHRFbmRMaW5lTnVtYmVyLCByZXN1bHRFbmRDb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZXN0IGlmIHRoaXMgcmFuZ2UgZXF1YWxzIG90aGVyLlxuICAgICAgICAgKi9cbiAgICAgICAgZXF1YWxzUmFuZ2Uob3RoZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5lcXVhbHNSYW5nZSh0aGlzLCBvdGhlcik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRlc3QgaWYgcmFuZ2UgYGFgIGVxdWFscyBgYmAuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgZXF1YWxzUmFuZ2UoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuICghIWEgJiZcbiAgICAgICAgICAgICAgICAhIWIgJiZcbiAgICAgICAgICAgICAgICBhLnN0YXJ0TGluZU51bWJlciA9PT0gYi5zdGFydExpbmVOdW1iZXIgJiZcbiAgICAgICAgICAgICAgICBhLnN0YXJ0Q29sdW1uID09PSBiLnN0YXJ0Q29sdW1uICYmXG4gICAgICAgICAgICAgICAgYS5lbmRMaW5lTnVtYmVyID09PSBiLmVuZExpbmVOdW1iZXIgJiZcbiAgICAgICAgICAgICAgICBhLmVuZENvbHVtbiA9PT0gYi5lbmRDb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm4gdGhlIGVuZCBwb3NpdGlvbiAod2hpY2ggd2lsbCBiZSBhZnRlciBvciBlcXVhbCB0byB0aGUgc3RhcnQgcG9zaXRpb24pXG4gICAgICAgICAqL1xuICAgICAgICBnZXRFbmRQb3NpdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgcG9zaXRpb25fMS52c2NNb2NrUG9zaXRpb24uUG9zaXRpb24odGhpcy5lbmRMaW5lTnVtYmVyLCB0aGlzLmVuZENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybiB0aGUgc3RhcnQgcG9zaXRpb24gKHdoaWNoIHdpbGwgYmUgYmVmb3JlIG9yIGVxdWFsIHRvIHRoZSBlbmQgcG9zaXRpb24pXG4gICAgICAgICAqL1xuICAgICAgICBnZXRTdGFydFBvc2l0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBwb3NpdGlvbl8xLnZzY01vY2tQb3NpdGlvbi5Qb3NpdGlvbih0aGlzLnN0YXJ0TGluZU51bWJlciwgdGhpcy5zdGFydENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRyYW5zZm9ybSB0byBhIHVzZXIgcHJlc2VudGFibGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdG9TdHJpbmcoKSB7XG4gICAgICAgICAgICByZXR1cm4gJ1snICsgdGhpcy5zdGFydExpbmVOdW1iZXIgKyAnLCcgKyB0aGlzLnN0YXJ0Q29sdW1uICsgJyAtPiAnICsgdGhpcy5lbmRMaW5lTnVtYmVyICsgJywnICsgdGhpcy5lbmRDb2x1bW4gKyAnXSc7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSBhIG5ldyByYW5nZSB1c2luZyB0aGlzIHJhbmdlJ3Mgc3RhcnQgcG9zaXRpb24sIGFuZCB1c2luZyBlbmRMaW5lTnVtYmVyIGFuZCBlbmRDb2x1bW4gYXMgdGhlIGVuZCBwb3NpdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHNldEVuZFBvc2l0aW9uKGVuZExpbmVOdW1iZXIsIGVuZENvbHVtbikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZSh0aGlzLnN0YXJ0TGluZU51bWJlciwgdGhpcy5zdGFydENvbHVtbiwgZW5kTGluZU51bWJlciwgZW5kQ29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQ3JlYXRlIGEgbmV3IHJhbmdlIHVzaW5nIHRoaXMgcmFuZ2UncyBlbmQgcG9zaXRpb24sIGFuZCB1c2luZyBzdGFydExpbmVOdW1iZXIgYW5kIHN0YXJ0Q29sdW1uIGFzIHRoZSBzdGFydCBwb3NpdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHNldFN0YXJ0UG9zaXRpb24oc3RhcnRMaW5lTnVtYmVyLCBzdGFydENvbHVtbikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShzdGFydExpbmVOdW1iZXIsIHN0YXJ0Q29sdW1uLCB0aGlzLmVuZExpbmVOdW1iZXIsIHRoaXMuZW5kQ29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQ3JlYXRlIGEgbmV3IGVtcHR5IHJhbmdlIHVzaW5nIHRoaXMgcmFuZ2UncyBzdGFydCBwb3NpdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIGNvbGxhcHNlVG9TdGFydCgpIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5jb2xsYXBzZVRvU3RhcnQodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSBhIG5ldyBlbXB0eSByYW5nZSB1c2luZyB0aGlzIHJhbmdlJ3Mgc3RhcnQgcG9zaXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgY29sbGFwc2VUb1N0YXJ0KHJhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHJhbmdlLnN0YXJ0TGluZU51bWJlciwgcmFuZ2Uuc3RhcnRDb2x1bW4sIHJhbmdlLnN0YXJ0TGluZU51bWJlciwgcmFuZ2Uuc3RhcnRDb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIC0tLVxuICAgICAgICBzdGF0aWMgZnJvbVBvc2l0aW9ucyhzdGFydCwgZW5kID0gc3RhcnQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2Uoc3RhcnQubGluZU51bWJlciwgc3RhcnQuY29sdW1uLCBlbmQubGluZU51bWJlciwgZW5kLmNvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSBhIGBSYW5nZWAgZnJvbSBhbiBgSVJhbmdlYC5cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBsaWZ0KHJhbmdlKSB7XG4gICAgICAgICAgICBpZiAoIXJhbmdlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHJhbmdlLnN0YXJ0TGluZU51bWJlciwgcmFuZ2Uuc3RhcnRDb2x1bW4sIHJhbmdlLmVuZExpbmVOdW1iZXIsIHJhbmdlLmVuZENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRlc3QgaWYgYG9iamAgaXMgYW4gYElSYW5nZWAuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgaXNJUmFuZ2Uob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4gKG9ialxuICAgICAgICAgICAgICAgICYmICh0eXBlb2Ygb2JqLnN0YXJ0TGluZU51bWJlciA9PT0gJ251bWJlcicpXG4gICAgICAgICAgICAgICAgJiYgKHR5cGVvZiBvYmouc3RhcnRDb2x1bW4gPT09ICdudW1iZXInKVxuICAgICAgICAgICAgICAgICYmICh0eXBlb2Ygb2JqLmVuZExpbmVOdW1iZXIgPT09ICdudW1iZXInKVxuICAgICAgICAgICAgICAgICYmICh0eXBlb2Ygb2JqLmVuZENvbHVtbiA9PT0gJ251bWJlcicpKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiB0aGUgdHdvIHJhbmdlcyBhcmUgdG91Y2hpbmcgaW4gYW55IHdheS5cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBhcmVJbnRlcnNlY3RpbmdPclRvdWNoaW5nKGEsIGIpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGBhYCBpcyBiZWZvcmUgYGJgXG4gICAgICAgICAgICBpZiAoYS5lbmRMaW5lTnVtYmVyIDwgYi5zdGFydExpbmVOdW1iZXIgfHwgKGEuZW5kTGluZU51bWJlciA9PT0gYi5zdGFydExpbmVOdW1iZXIgJiYgYS5lbmRDb2x1bW4gPCBiLnN0YXJ0Q29sdW1uKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGBiYCBpcyBiZWZvcmUgYGFgXG4gICAgICAgICAgICBpZiAoYi5lbmRMaW5lTnVtYmVyIDwgYS5zdGFydExpbmVOdW1iZXIgfHwgKGIuZW5kTGluZU51bWJlciA9PT0gYS5zdGFydExpbmVOdW1iZXIgJiYgYi5lbmRDb2x1bW4gPCBhLnN0YXJ0Q29sdW1uKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoZXNlIHJhbmdlcyBtdXN0IGludGVyc2VjdFxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZnVuY3Rpb24gdGhhdCBjb21wYXJlcyByYW5nZXMsIHVzZWZ1bCBmb3Igc29ydGluZyByYW5nZXNcbiAgICAgICAgICogSXQgd2lsbCBmaXJzdCBjb21wYXJlIHJhbmdlcyBvbiB0aGUgc3RhcnRQb3NpdGlvbiBhbmQgdGhlbiBvbiB0aGUgZW5kUG9zaXRpb25cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBjb21wYXJlUmFuZ2VzVXNpbmdTdGFydHMoYSwgYikge1xuICAgICAgICAgICAgbGV0IGFTdGFydExpbmVOdW1iZXIgPSBhLnN0YXJ0TGluZU51bWJlciB8IDA7XG4gICAgICAgICAgICBsZXQgYlN0YXJ0TGluZU51bWJlciA9IGIuc3RhcnRMaW5lTnVtYmVyIHwgMDtcbiAgICAgICAgICAgIGlmIChhU3RhcnRMaW5lTnVtYmVyID09PSBiU3RhcnRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgbGV0IGFTdGFydENvbHVtbiA9IGEuc3RhcnRDb2x1bW4gfCAwO1xuICAgICAgICAgICAgICAgIGxldCBiU3RhcnRDb2x1bW4gPSBiLnN0YXJ0Q29sdW1uIHwgMDtcbiAgICAgICAgICAgICAgICBpZiAoYVN0YXJ0Q29sdW1uID09PSBiU3RhcnRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFFbmRMaW5lTnVtYmVyID0gYS5lbmRMaW5lTnVtYmVyIHwgMDtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJFbmRMaW5lTnVtYmVyID0gYi5lbmRMaW5lTnVtYmVyIHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFFbmRMaW5lTnVtYmVyID09PSBiRW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFFbmRDb2x1bW4gPSBhLmVuZENvbHVtbiB8IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYkVuZENvbHVtbiA9IGIuZW5kQ29sdW1uIHwgMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhRW5kQ29sdW1uIC0gYkVuZENvbHVtbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYUVuZExpbmVOdW1iZXIgLSBiRW5kTGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFTdGFydENvbHVtbiAtIGJTdGFydENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhU3RhcnRMaW5lTnVtYmVyIC0gYlN0YXJ0TGluZU51bWJlcjtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQSBmdW5jdGlvbiB0aGF0IGNvbXBhcmVzIHJhbmdlcywgdXNlZnVsIGZvciBzb3J0aW5nIHJhbmdlc1xuICAgICAgICAgKiBJdCB3aWxsIGZpcnN0IGNvbXBhcmUgcmFuZ2VzIG9uIHRoZSBlbmRQb3NpdGlvbiBhbmQgdGhlbiBvbiB0aGUgc3RhcnRQb3NpdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIGNvbXBhcmVSYW5nZXNVc2luZ0VuZHMoYSwgYikge1xuICAgICAgICAgICAgaWYgKGEuZW5kTGluZU51bWJlciA9PT0gYi5lbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGEuZW5kQ29sdW1uID09PSBiLmVuZENvbHVtbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYS5zdGFydExpbmVOdW1iZXIgPT09IGIuc3RhcnRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5zdGFydENvbHVtbiAtIGIuc3RhcnRDb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3RhcnRMaW5lTnVtYmVyIC0gYi5zdGFydExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhLmVuZENvbHVtbiAtIGIuZW5kQ29sdW1uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGEuZW5kTGluZU51bWJlciAtIGIuZW5kTGluZU51bWJlcjtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiB0aGUgcmFuZ2Ugc3BhbnMgbXVsdGlwbGUgbGluZXMuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgc3BhbnNNdWx0aXBsZUxpbmVzKHJhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmFuZ2UuZW5kTGluZU51bWJlciA+IHJhbmdlLnN0YXJ0TGluZU51bWJlcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2c2NNb2NrUmFuZ2UuUmFuZ2UgPSBSYW5nZTtcbn0pKHZzY01vY2tSYW5nZSA9IGV4cG9ydHMudnNjTW9ja1JhbmdlIHx8IChleHBvcnRzLnZzY01vY2tSYW5nZSA9IHt9KSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yYW5nZS5qcy5tYXAiXX0=
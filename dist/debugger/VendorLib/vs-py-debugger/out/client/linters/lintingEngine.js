// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const minimatch_1 = require("minimatch");

const path = require("path");

const vscode = require("vscode");

const types_1 = require("../common/application/types");

const constants_1 = require("../common/constants");

const types_2 = require("../common/platform/types");

const types_3 = require("../common/types");

const stopWatch_1 = require("../common/utils/stopWatch");

const types_4 = require("../ioc/types");

const provider_1 = require("../jupyter/provider");

const telemetry_1 = require("../telemetry");

const constants_2 = require("../telemetry/constants");

const types_5 = require("./types");

const PYTHON = {
  language: 'python'
};
const lintSeverityToVSSeverity = new Map();
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Error, vscode.DiagnosticSeverity.Error);
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Hint, vscode.DiagnosticSeverity.Hint);
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Information, vscode.DiagnosticSeverity.Information);
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Warning, vscode.DiagnosticSeverity.Warning);
let LintingEngine = class LintingEngine {
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
    this.pendingLintings = new Map();

    this.documentHasJupyterCodeCells = (a, b) => Promise.resolve(false);

    this.documents = serviceContainer.get(types_1.IDocumentManager);
    this.workspace = serviceContainer.get(types_1.IWorkspaceService);
    this.configurationService = serviceContainer.get(types_3.IConfigurationService);
    this.outputChannel = serviceContainer.get(types_3.IOutputChannel, constants_1.STANDARD_OUTPUT_CHANNEL);
    this.linterManager = serviceContainer.get(types_5.ILinterManager);
    this.fileSystem = serviceContainer.get(types_2.IFileSystem);
    this.diagnosticCollection = vscode.languages.createDiagnosticCollection('python');
  }

  get diagnostics() {
    return this.diagnosticCollection;
  }

  clearDiagnostics(document) {
    if (this.diagnosticCollection.has(document.uri)) {
      this.diagnosticCollection.delete(document.uri);
    }
  }

  lintOpenPythonFiles() {
    return __awaiter(this, void 0, void 0, function* () {
      this.diagnosticCollection.clear();
      const promises = this.documents.textDocuments.map(document => __awaiter(this, void 0, void 0, function* () {
        return this.lintDocument(document, 'auto');
      }));
      yield Promise.all(promises);
      return this.diagnosticCollection;
    });
  }

  lintDocument(document, trigger) {
    return __awaiter(this, void 0, void 0, function* () {
      this.diagnosticCollection.set(document.uri, []); // Check if we need to lint this document

      if (!(yield this.shouldLintDocument(document))) {
        return;
      }

      if (this.pendingLintings.has(document.uri.fsPath)) {
        this.pendingLintings.get(document.uri.fsPath).cancel();
        this.pendingLintings.delete(document.uri.fsPath);
      }

      const cancelToken = new vscode.CancellationTokenSource();
      cancelToken.token.onCancellationRequested(() => {
        if (this.pendingLintings.has(document.uri.fsPath)) {
          this.pendingLintings.delete(document.uri.fsPath);
        }
      });
      this.pendingLintings.set(document.uri.fsPath, cancelToken);
      const activeLinters = yield this.linterManager.getActiveLinters(false, document.uri);
      const promises = activeLinters.map(info => __awaiter(this, void 0, void 0, function* () {
        const stopWatch = new stopWatch_1.StopWatch();
        const linter = yield this.linterManager.createLinter(info.product, this.outputChannel, this.serviceContainer, document.uri);
        const promise = linter.lint(document, cancelToken.token);
        this.sendLinterRunTelemetry(info, document.uri, promise, stopWatch, trigger);
        return promise;
      }));
      const hasJupyterCodeCells = yield this.documentHasJupyterCodeCells(document, cancelToken.token); // linters will resolve asynchronously - keep a track of all
      // diagnostics reported as them come in.

      let diagnostics = [];
      const settings = this.configurationService.getSettings(document.uri);

      for (const p of promises) {
        const msgs = yield p;

        if (cancelToken.token.isCancellationRequested) {
          break;
        }

        if (this.isDocumentOpen(document.uri)) {
          // Build the message and suffix the message with the name of the linter used.
          for (const m of msgs) {
            // Ignore magic commands from jupyter.
            if (hasJupyterCodeCells && document.lineAt(m.line - 1).text.trim().startsWith('%') && (m.code === constants_1.LinterErrors.pylint.InvalidSyntax || m.code === constants_1.LinterErrors.prospector.InvalidSyntax || m.code === constants_1.LinterErrors.flake8.InvalidSyntax)) {
              continue;
            }

            diagnostics.push(this.createDiagnostics(m, document));
          } // Limit the number of messages to the max value.


          diagnostics = diagnostics.filter((value, index) => index <= settings.linting.maxNumberOfProblems);
        }
      } // Set all diagnostics found in this pass, as this method always clears existing diagnostics.


      this.diagnosticCollection.set(document.uri, diagnostics);
    });
  } // tslint:disable-next-line:no-any


  linkJupyterExtension(jupyter) {
    return __awaiter(this, void 0, void 0, function* () {
      if (!jupyter) {
        return;
      }

      if (!jupyter.isActive) {
        yield jupyter.activate();
      } // tslint:disable-next-line:no-unsafe-any


      jupyter.exports.registerLanguageProvider(PYTHON.language, new provider_1.JupyterProvider()); // tslint:disable-next-line:no-unsafe-any

      this.documentHasJupyterCodeCells = jupyter.exports.hasCodeCells;
    });
  }

  sendLinterRunTelemetry(info, resource, promise, stopWatch, trigger) {
    const linterExecutablePathName = info.pathName(resource);
    const properties = {
      tool: info.id,
      hasCustomArgs: info.linterArgs(resource).length > 0,
      trigger,
      executableSpecified: linterExecutablePathName.length > 0
    };
    telemetry_1.sendTelemetryWhenDone(constants_2.LINTING, promise, stopWatch, properties);
  }

  isDocumentOpen(uri) {
    return this.documents.textDocuments.some(document => document.uri.fsPath === uri.fsPath);
  }

  createDiagnostics(message, document) {
    const position = new vscode.Position(message.line - 1, message.column);
    const range = new vscode.Range(position, position);
    const severity = lintSeverityToVSSeverity.get(message.severity);
    const diagnostic = new vscode.Diagnostic(range, message.message, severity);
    diagnostic.code = message.code;
    diagnostic.source = message.provider;
    return diagnostic;
  }

  shouldLintDocument(document) {
    return __awaiter(this, void 0, void 0, function* () {
      if (!(yield this.linterManager.isLintingEnabled(false, document.uri))) {
        this.diagnosticCollection.set(document.uri, []);
        return false;
      }

      if (document.languageId !== PYTHON.language) {
        return false;
      }

      const workspaceFolder = this.workspace.getWorkspaceFolder(document.uri);
      const workspaceRootPath = workspaceFolder && typeof workspaceFolder.uri.fsPath === 'string' ? workspaceFolder.uri.fsPath : undefined;
      const relativeFileName = typeof workspaceRootPath === 'string' ? path.relative(workspaceRootPath, document.fileName) : document.fileName;
      const settings = this.configurationService.getSettings(document.uri);
      const ignoreMinmatches = settings.linting.ignorePatterns.map(pattern => new minimatch_1.Minimatch(pattern));

      if (ignoreMinmatches.some(matcher => matcher.match(document.fileName) || matcher.match(relativeFileName))) {
        return false;
      }

      if (document.uri.scheme !== 'file' || !document.uri.fsPath) {
        return false;
      }

      return this.fileSystem.fileExists(document.uri.fsPath);
    });
  }

};
LintingEngine = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_4.IServiceContainer))], LintingEngine);
exports.LintingEngine = LintingEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpbnRpbmdFbmdpbmUuanMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsImRlY29yYXRvcnMiLCJ0YXJnZXQiLCJrZXkiLCJkZXNjIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJkIiwiUmVmbGVjdCIsImRlY29yYXRlIiwiaSIsImRlZmluZVByb3BlcnR5IiwiX19wYXJhbSIsInBhcmFtSW5kZXgiLCJkZWNvcmF0b3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsIm1pbmltYXRjaF8xIiwicGF0aCIsInZzY29kZSIsInR5cGVzXzEiLCJjb25zdGFudHNfMSIsInR5cGVzXzIiLCJ0eXBlc18zIiwic3RvcFdhdGNoXzEiLCJ0eXBlc180IiwicHJvdmlkZXJfMSIsInRlbGVtZXRyeV8xIiwiY29uc3RhbnRzXzIiLCJ0eXBlc181IiwiUFlUSE9OIiwibGFuZ3VhZ2UiLCJsaW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkiLCJNYXAiLCJzZXQiLCJMaW50TWVzc2FnZVNldmVyaXR5IiwiRXJyb3IiLCJEaWFnbm9zdGljU2V2ZXJpdHkiLCJIaW50IiwiSW5mb3JtYXRpb24iLCJXYXJuaW5nIiwiTGludGluZ0VuZ2luZSIsImNvbnN0cnVjdG9yIiwic2VydmljZUNvbnRhaW5lciIsInBlbmRpbmdMaW50aW5ncyIsImRvY3VtZW50SGFzSnVweXRlckNvZGVDZWxscyIsImEiLCJiIiwiZG9jdW1lbnRzIiwiZ2V0IiwiSURvY3VtZW50TWFuYWdlciIsIndvcmtzcGFjZSIsIklXb3Jrc3BhY2VTZXJ2aWNlIiwiY29uZmlndXJhdGlvblNlcnZpY2UiLCJJQ29uZmlndXJhdGlvblNlcnZpY2UiLCJvdXRwdXRDaGFubmVsIiwiSU91dHB1dENoYW5uZWwiLCJTVEFOREFSRF9PVVRQVVRfQ0hBTk5FTCIsImxpbnRlck1hbmFnZXIiLCJJTGludGVyTWFuYWdlciIsImZpbGVTeXN0ZW0iLCJJRmlsZVN5c3RlbSIsImRpYWdub3N0aWNDb2xsZWN0aW9uIiwibGFuZ3VhZ2VzIiwiY3JlYXRlRGlhZ25vc3RpY0NvbGxlY3Rpb24iLCJkaWFnbm9zdGljcyIsImNsZWFyRGlhZ25vc3RpY3MiLCJkb2N1bWVudCIsImhhcyIsInVyaSIsImRlbGV0ZSIsImxpbnRPcGVuUHl0aG9uRmlsZXMiLCJjbGVhciIsInByb21pc2VzIiwidGV4dERvY3VtZW50cyIsIm1hcCIsImxpbnREb2N1bWVudCIsImFsbCIsInRyaWdnZXIiLCJzaG91bGRMaW50RG9jdW1lbnQiLCJmc1BhdGgiLCJjYW5jZWwiLCJjYW5jZWxUb2tlbiIsIkNhbmNlbGxhdGlvblRva2VuU291cmNlIiwidG9rZW4iLCJvbkNhbmNlbGxhdGlvblJlcXVlc3RlZCIsImFjdGl2ZUxpbnRlcnMiLCJnZXRBY3RpdmVMaW50ZXJzIiwiaW5mbyIsInN0b3BXYXRjaCIsIlN0b3BXYXRjaCIsImxpbnRlciIsImNyZWF0ZUxpbnRlciIsInByb2R1Y3QiLCJwcm9taXNlIiwibGludCIsInNlbmRMaW50ZXJSdW5UZWxlbWV0cnkiLCJoYXNKdXB5dGVyQ29kZUNlbGxzIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsInAiLCJtc2dzIiwiaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQiLCJpc0RvY3VtZW50T3BlbiIsIm0iLCJsaW5lQXQiLCJsaW5lIiwidGV4dCIsInRyaW0iLCJzdGFydHNXaXRoIiwiY29kZSIsIkxpbnRlckVycm9ycyIsInB5bGludCIsIkludmFsaWRTeW50YXgiLCJwcm9zcGVjdG9yIiwiZmxha2U4IiwicHVzaCIsImNyZWF0ZURpYWdub3N0aWNzIiwiZmlsdGVyIiwiaW5kZXgiLCJsaW50aW5nIiwibWF4TnVtYmVyT2ZQcm9ibGVtcyIsImxpbmtKdXB5dGVyRXh0ZW5zaW9uIiwianVweXRlciIsImlzQWN0aXZlIiwiYWN0aXZhdGUiLCJyZWdpc3Rlckxhbmd1YWdlUHJvdmlkZXIiLCJKdXB5dGVyUHJvdmlkZXIiLCJoYXNDb2RlQ2VsbHMiLCJyZXNvdXJjZSIsImxpbnRlckV4ZWN1dGFibGVQYXRoTmFtZSIsInBhdGhOYW1lIiwicHJvcGVydGllcyIsInRvb2wiLCJpZCIsImhhc0N1c3RvbUFyZ3MiLCJsaW50ZXJBcmdzIiwiZXhlY3V0YWJsZVNwZWNpZmllZCIsInNlbmRUZWxlbWV0cnlXaGVuRG9uZSIsIkxJTlRJTkciLCJzb21lIiwibWVzc2FnZSIsInBvc2l0aW9uIiwiUG9zaXRpb24iLCJjb2x1bW4iLCJyYW5nZSIsIlJhbmdlIiwic2V2ZXJpdHkiLCJkaWFnbm9zdGljIiwiRGlhZ25vc3RpYyIsInNvdXJjZSIsInByb3ZpZGVyIiwiaXNMaW50aW5nRW5hYmxlZCIsImxhbmd1YWdlSWQiLCJ3b3Jrc3BhY2VGb2xkZXIiLCJnZXRXb3Jrc3BhY2VGb2xkZXIiLCJ3b3Jrc3BhY2VSb290UGF0aCIsInVuZGVmaW5lZCIsInJlbGF0aXZlRmlsZU5hbWUiLCJyZWxhdGl2ZSIsImZpbGVOYW1lIiwiaWdub3JlTWlubWF0Y2hlcyIsImlnbm9yZVBhdHRlcm5zIiwicGF0dGVybiIsIk1pbmltYXRjaCIsIm1hdGNoZXIiLCJtYXRjaCIsInNjaGVtZSIsImZpbGVFeGlzdHMiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiSVNlcnZpY2VDb250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxVQUFVLEdBQUksVUFBUSxTQUFLQSxVQUFkLElBQTZCLFVBQVVDLFVBQVYsRUFBc0JDLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0MsSUFBbkMsRUFBeUM7QUFDbkYsTUFBSUMsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQWxCO0FBQUEsTUFBMEJD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QVEsQ0FBQzZGLFFBQXZCLEtBQW9DSyxPQUFPLENBQUNDLEtBQVIsQ0FBY1IsZ0JBQWQsQ0FBckUsQ0FBSixFQUEyRztBQUN2RyxlQUFPLEtBQVA7QUFDSDs7QUFDRCxVQUFJM0YsUUFBUSxDQUFDRSxHQUFULENBQWFrRyxNQUFiLEtBQXdCLE1BQXhCLElBQWtDLENBQUNwRyxRQUFRLENBQUNFLEdBQVQsQ0FBYVcsTUFBcEQsRUFBNEQ7QUFDeEQsZUFBTyxLQUFQO0FBQ0g7O0FBQ0QsYUFBTyxLQUFLcEIsVUFBTCxDQUFnQjRHLFVBQWhCLENBQTJCckcsUUFBUSxDQUFDRSxHQUFULENBQWFXLE1BQXhDLENBQVA7QUFDSCxLQXBCZSxDQUFoQjtBQXFCSDs7QUFqSm1DLENBQXhDO0FBbUpBdkMsYUFBYSxHQUFHaEUsVUFBVSxDQUFDLENBQ3ZCc0MsV0FBVyxDQUFDMEosVUFBWixFQUR1QixFQUV2QmhMLE9BQU8sQ0FBQyxDQUFELEVBQUlzQixXQUFXLENBQUMySixNQUFaLENBQW1CakosT0FBTyxDQUFDa0osaUJBQTNCLENBQUosQ0FGZ0IsQ0FBRCxFQUd2QmxJLGFBSHVCLENBQTFCO0FBSUEzQixPQUFPLENBQUMyQixhQUFSLEdBQXdCQSxhQUF4QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxuJ3VzZSBzdHJpY3QnO1xudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcbmNvbnN0IG1pbmltYXRjaF8xID0gcmVxdWlyZShcIm1pbmltYXRjaFwiKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbmNvbnN0IHZzY29kZSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9hcHBsaWNhdGlvbi90eXBlc1wiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9jb25zdGFudHNcIik7XG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uL2NvbW1vbi9wbGF0Zm9ybS90eXBlc1wiKTtcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vY29tbW9uL3R5cGVzXCIpO1xuY29uc3Qgc3RvcFdhdGNoXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL3V0aWxzL3N0b3BXYXRjaFwiKTtcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vaW9jL3R5cGVzXCIpO1xuY29uc3QgcHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuLi9qdXB5dGVyL3Byb3ZpZGVyXCIpO1xuY29uc3QgdGVsZW1ldHJ5XzEgPSByZXF1aXJlKFwiLi4vdGVsZW1ldHJ5XCIpO1xuY29uc3QgY29uc3RhbnRzXzIgPSByZXF1aXJlKFwiLi4vdGVsZW1ldHJ5L2NvbnN0YW50c1wiKTtcbmNvbnN0IHR5cGVzXzUgPSByZXF1aXJlKFwiLi90eXBlc1wiKTtcbmNvbnN0IFBZVEhPTiA9IHsgbGFuZ3VhZ2U6ICdweXRob24nIH07XG5jb25zdCBsaW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkgPSBuZXcgTWFwKCk7XG5saW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkuc2V0KHR5cGVzXzUuTGludE1lc3NhZ2VTZXZlcml0eS5FcnJvciwgdnNjb2RlLkRpYWdub3N0aWNTZXZlcml0eS5FcnJvcik7XG5saW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkuc2V0KHR5cGVzXzUuTGludE1lc3NhZ2VTZXZlcml0eS5IaW50LCB2c2NvZGUuRGlhZ25vc3RpY1NldmVyaXR5LkhpbnQpO1xubGludFNldmVyaXR5VG9WU1NldmVyaXR5LnNldCh0eXBlc181LkxpbnRNZXNzYWdlU2V2ZXJpdHkuSW5mb3JtYXRpb24sIHZzY29kZS5EaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb24pO1xubGludFNldmVyaXR5VG9WU1NldmVyaXR5LnNldCh0eXBlc181LkxpbnRNZXNzYWdlU2V2ZXJpdHkuV2FybmluZywgdnNjb2RlLkRpYWdub3N0aWNTZXZlcml0eS5XYXJuaW5nKTtcbmxldCBMaW50aW5nRW5naW5lID0gY2xhc3MgTGludGluZ0VuZ2luZSB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICB0aGlzLnNlcnZpY2VDb250YWluZXIgPSBzZXJ2aWNlQ29udGFpbmVyO1xuICAgICAgICB0aGlzLnBlbmRpbmdMaW50aW5ncyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5kb2N1bWVudEhhc0p1cHl0ZXJDb2RlQ2VsbHMgPSAoYSwgYikgPT4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgdGhpcy5kb2N1bWVudHMgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18xLklEb2N1bWVudE1hbmFnZXIpO1xuICAgICAgICB0aGlzLndvcmtzcGFjZSA9IHNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzEuSVdvcmtzcGFjZVNlcnZpY2UpO1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25TZXJ2aWNlID0gc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMy5JQ29uZmlndXJhdGlvblNlcnZpY2UpO1xuICAgICAgICB0aGlzLm91dHB1dENoYW5uZWwgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18zLklPdXRwdXRDaGFubmVsLCBjb25zdGFudHNfMS5TVEFOREFSRF9PVVRQVVRfQ0hBTk5FTCk7XG4gICAgICAgIHRoaXMubGludGVyTWFuYWdlciA9IHNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzUuSUxpbnRlck1hbmFnZXIpO1xuICAgICAgICB0aGlzLmZpbGVTeXN0ZW0gPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklGaWxlU3lzdGVtKTtcbiAgICAgICAgdGhpcy5kaWFnbm9zdGljQ29sbGVjdGlvbiA9IHZzY29kZS5sYW5ndWFnZXMuY3JlYXRlRGlhZ25vc3RpY0NvbGxlY3Rpb24oJ3B5dGhvbicpO1xuICAgIH1cbiAgICBnZXQgZGlhZ25vc3RpY3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uO1xuICAgIH1cbiAgICBjbGVhckRpYWdub3N0aWNzKGRvY3VtZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uLmhhcyhkb2N1bWVudC51cmkpKSB7XG4gICAgICAgICAgICB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uLmRlbGV0ZShkb2N1bWVudC51cmkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxpbnRPcGVuUHl0aG9uRmlsZXMoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uLmNsZWFyKCk7XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IHRoaXMuZG9jdW1lbnRzLnRleHREb2N1bWVudHMubWFwKChkb2N1bWVudCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgeyByZXR1cm4gdGhpcy5saW50RG9jdW1lbnQoZG9jdW1lbnQsICdhdXRvJyk7IH0pKTtcbiAgICAgICAgICAgIHlpZWxkIFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgbGludERvY3VtZW50KGRvY3VtZW50LCB0cmlnZ2VyKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uLnNldChkb2N1bWVudC51cmksIFtdKTtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gbGludCB0aGlzIGRvY3VtZW50XG4gICAgICAgICAgICBpZiAoISh5aWVsZCB0aGlzLnNob3VsZExpbnREb2N1bWVudChkb2N1bWVudCkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMucGVuZGluZ0xpbnRpbmdzLmhhcyhkb2N1bWVudC51cmkuZnNQYXRoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0xpbnRpbmdzLmdldChkb2N1bWVudC51cmkuZnNQYXRoKS5jYW5jZWwoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdMaW50aW5ncy5kZWxldGUoZG9jdW1lbnQudXJpLmZzUGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjYW5jZWxUb2tlbiA9IG5ldyB2c2NvZGUuQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTtcbiAgICAgICAgICAgIGNhbmNlbFRva2VuLnRva2VuLm9uQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wZW5kaW5nTGludGluZ3MuaGFzKGRvY3VtZW50LnVyaS5mc1BhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0xpbnRpbmdzLmRlbGV0ZShkb2N1bWVudC51cmkuZnNQYXRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ0xpbnRpbmdzLnNldChkb2N1bWVudC51cmkuZnNQYXRoLCBjYW5jZWxUb2tlbik7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVMaW50ZXJzID0geWllbGQgdGhpcy5saW50ZXJNYW5hZ2VyLmdldEFjdGl2ZUxpbnRlcnMoZmFsc2UsIGRvY3VtZW50LnVyaSk7XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IGFjdGl2ZUxpbnRlcnNcbiAgICAgICAgICAgICAgICAubWFwKChpbmZvKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvcFdhdGNoID0gbmV3IHN0b3BXYXRjaF8xLlN0b3BXYXRjaCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpbnRlciA9IHlpZWxkIHRoaXMubGludGVyTWFuYWdlci5jcmVhdGVMaW50ZXIoaW5mby5wcm9kdWN0LCB0aGlzLm91dHB1dENoYW5uZWwsIHRoaXMuc2VydmljZUNvbnRhaW5lciwgZG9jdW1lbnQudXJpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlID0gbGludGVyLmxpbnQoZG9jdW1lbnQsIGNhbmNlbFRva2VuLnRva2VuKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRMaW50ZXJSdW5UZWxlbWV0cnkoaW5mbywgZG9jdW1lbnQudXJpLCBwcm9taXNlLCBzdG9wV2F0Y2gsIHRyaWdnZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgaGFzSnVweXRlckNvZGVDZWxscyA9IHlpZWxkIHRoaXMuZG9jdW1lbnRIYXNKdXB5dGVyQ29kZUNlbGxzKGRvY3VtZW50LCBjYW5jZWxUb2tlbi50b2tlbik7XG4gICAgICAgICAgICAvLyBsaW50ZXJzIHdpbGwgcmVzb2x2ZSBhc3luY2hyb25vdXNseSAtIGtlZXAgYSB0cmFjayBvZiBhbGxcbiAgICAgICAgICAgIC8vIGRpYWdub3N0aWNzIHJlcG9ydGVkIGFzIHRoZW0gY29tZSBpbi5cbiAgICAgICAgICAgIGxldCBkaWFnbm9zdGljcyA9IFtdO1xuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldFNldHRpbmdzKGRvY3VtZW50LnVyaSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgcHJvbWlzZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtc2dzID0geWllbGQgcDtcbiAgICAgICAgICAgICAgICBpZiAoY2FuY2VsVG9rZW4udG9rZW4uaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRG9jdW1lbnRPcGVuKGRvY3VtZW50LnVyaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQnVpbGQgdGhlIG1lc3NhZ2UgYW5kIHN1ZmZpeCB0aGUgbWVzc2FnZSB3aXRoIHRoZSBuYW1lIG9mIHRoZSBsaW50ZXIgdXNlZC5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBtIG9mIG1zZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBtYWdpYyBjb21tYW5kcyBmcm9tIGp1cHl0ZXIuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzSnVweXRlckNvZGVDZWxscyAmJiBkb2N1bWVudC5saW5lQXQobS5saW5lIC0gMSkudGV4dC50cmltKCkuc3RhcnRzV2l0aCgnJScpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0uY29kZSA9PT0gY29uc3RhbnRzXzEuTGludGVyRXJyb3JzLnB5bGludC5JbnZhbGlkU3ludGF4IHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uY29kZSA9PT0gY29uc3RhbnRzXzEuTGludGVyRXJyb3JzLnByb3NwZWN0b3IuSW52YWxpZFN5bnRheCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvZGUgPT09IGNvbnN0YW50c18xLkxpbnRlckVycm9ycy5mbGFrZTguSW52YWxpZFN5bnRheCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWdub3N0aWNzLnB1c2godGhpcy5jcmVhdGVEaWFnbm9zdGljcyhtLCBkb2N1bWVudCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIExpbWl0IHRoZSBudW1iZXIgb2YgbWVzc2FnZXMgdG8gdGhlIG1heCB2YWx1ZS5cbiAgICAgICAgICAgICAgICAgICAgZGlhZ25vc3RpY3MgPSBkaWFnbm9zdGljcy5maWx0ZXIoKHZhbHVlLCBpbmRleCkgPT4gaW5kZXggPD0gc2V0dGluZ3MubGludGluZy5tYXhOdW1iZXJPZlByb2JsZW1zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBTZXQgYWxsIGRpYWdub3N0aWNzIGZvdW5kIGluIHRoaXMgcGFzcywgYXMgdGhpcyBtZXRob2QgYWx3YXlzIGNsZWFycyBleGlzdGluZyBkaWFnbm9zdGljcy5cbiAgICAgICAgICAgIHRoaXMuZGlhZ25vc3RpY0NvbGxlY3Rpb24uc2V0KGRvY3VtZW50LnVyaSwgZGlhZ25vc3RpY3MpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuICAgIGxpbmtKdXB5dGVyRXh0ZW5zaW9uKGp1cHl0ZXIpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGlmICghanVweXRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghanVweXRlci5pc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHlpZWxkIGp1cHl0ZXIuYWN0aXZhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bnNhZmUtYW55XG4gICAgICAgICAgICBqdXB5dGVyLmV4cG9ydHMucmVnaXN0ZXJMYW5ndWFnZVByb3ZpZGVyKFBZVEhPTi5sYW5ndWFnZSwgbmV3IHByb3ZpZGVyXzEuSnVweXRlclByb3ZpZGVyKCkpO1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuc2FmZS1hbnlcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRIYXNKdXB5dGVyQ29kZUNlbGxzID0ganVweXRlci5leHBvcnRzLmhhc0NvZGVDZWxscztcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNlbmRMaW50ZXJSdW5UZWxlbWV0cnkoaW5mbywgcmVzb3VyY2UsIHByb21pc2UsIHN0b3BXYXRjaCwgdHJpZ2dlcikge1xuICAgICAgICBjb25zdCBsaW50ZXJFeGVjdXRhYmxlUGF0aE5hbWUgPSBpbmZvLnBhdGhOYW1lKHJlc291cmNlKTtcbiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIHRvb2w6IGluZm8uaWQsXG4gICAgICAgICAgICBoYXNDdXN0b21BcmdzOiBpbmZvLmxpbnRlckFyZ3MocmVzb3VyY2UpLmxlbmd0aCA+IDAsXG4gICAgICAgICAgICB0cmlnZ2VyLFxuICAgICAgICAgICAgZXhlY3V0YWJsZVNwZWNpZmllZDogbGludGVyRXhlY3V0YWJsZVBhdGhOYW1lLmxlbmd0aCA+IDBcbiAgICAgICAgfTtcbiAgICAgICAgdGVsZW1ldHJ5XzEuc2VuZFRlbGVtZXRyeVdoZW5Eb25lKGNvbnN0YW50c18yLkxJTlRJTkcsIHByb21pc2UsIHN0b3BXYXRjaCwgcHJvcGVydGllcyk7XG4gICAgfVxuICAgIGlzRG9jdW1lbnRPcGVuKHVyaSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudHMudGV4dERvY3VtZW50cy5zb21lKGRvY3VtZW50ID0+IGRvY3VtZW50LnVyaS5mc1BhdGggPT09IHVyaS5mc1BhdGgpO1xuICAgIH1cbiAgICBjcmVhdGVEaWFnbm9zdGljcyhtZXNzYWdlLCBkb2N1bWVudCkge1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG5ldyB2c2NvZGUuUG9zaXRpb24obWVzc2FnZS5saW5lIC0gMSwgbWVzc2FnZS5jb2x1bW4pO1xuICAgICAgICBjb25zdCByYW5nZSA9IG5ldyB2c2NvZGUuUmFuZ2UocG9zaXRpb24sIHBvc2l0aW9uKTtcbiAgICAgICAgY29uc3Qgc2V2ZXJpdHkgPSBsaW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkuZ2V0KG1lc3NhZ2Uuc2V2ZXJpdHkpO1xuICAgICAgICBjb25zdCBkaWFnbm9zdGljID0gbmV3IHZzY29kZS5EaWFnbm9zdGljKHJhbmdlLCBtZXNzYWdlLm1lc3NhZ2UsIHNldmVyaXR5KTtcbiAgICAgICAgZGlhZ25vc3RpYy5jb2RlID0gbWVzc2FnZS5jb2RlO1xuICAgICAgICBkaWFnbm9zdGljLnNvdXJjZSA9IG1lc3NhZ2UucHJvdmlkZXI7XG4gICAgICAgIHJldHVybiBkaWFnbm9zdGljO1xuICAgIH1cbiAgICBzaG91bGRMaW50RG9jdW1lbnQoZG9jdW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGlmICghKHlpZWxkIHRoaXMubGludGVyTWFuYWdlci5pc0xpbnRpbmdFbmFibGVkKGZhbHNlLCBkb2N1bWVudC51cmkpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlhZ25vc3RpY0NvbGxlY3Rpb24uc2V0KGRvY3VtZW50LnVyaSwgW10pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5sYW5ndWFnZUlkICE9PSBQWVRIT04ubGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB3b3Jrc3BhY2VGb2xkZXIgPSB0aGlzLndvcmtzcGFjZS5nZXRXb3Jrc3BhY2VGb2xkZXIoZG9jdW1lbnQudXJpKTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZVJvb3RQYXRoID0gKHdvcmtzcGFjZUZvbGRlciAmJiB0eXBlb2Ygd29ya3NwYWNlRm9sZGVyLnVyaS5mc1BhdGggPT09ICdzdHJpbmcnKSA/IHdvcmtzcGFjZUZvbGRlci51cmkuZnNQYXRoIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVGaWxlTmFtZSA9IHR5cGVvZiB3b3Jrc3BhY2VSb290UGF0aCA9PT0gJ3N0cmluZycgPyBwYXRoLnJlbGF0aXZlKHdvcmtzcGFjZVJvb3RQYXRoLCBkb2N1bWVudC5maWxlTmFtZSkgOiBkb2N1bWVudC5maWxlTmFtZTtcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5jb25maWd1cmF0aW9uU2VydmljZS5nZXRTZXR0aW5ncyhkb2N1bWVudC51cmkpO1xuICAgICAgICAgICAgY29uc3QgaWdub3JlTWlubWF0Y2hlcyA9IHNldHRpbmdzLmxpbnRpbmcuaWdub3JlUGF0dGVybnMubWFwKHBhdHRlcm4gPT4gbmV3IG1pbmltYXRjaF8xLk1pbmltYXRjaChwYXR0ZXJuKSk7XG4gICAgICAgICAgICBpZiAoaWdub3JlTWlubWF0Y2hlcy5zb21lKG1hdGNoZXIgPT4gbWF0Y2hlci5tYXRjaChkb2N1bWVudC5maWxlTmFtZSkgfHwgbWF0Y2hlci5tYXRjaChyZWxhdGl2ZUZpbGVOYW1lKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQudXJpLnNjaGVtZSAhPT0gJ2ZpbGUnIHx8ICFkb2N1bWVudC51cmkuZnNQYXRoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZVN5c3RlbS5maWxlRXhpc3RzKGRvY3VtZW50LnVyaS5mc1BhdGgpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuTGludGluZ0VuZ2luZSA9IF9fZGVjb3JhdGUoW1xuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcbiAgICBfX3BhcmFtKDAsIGludmVyc2lmeV8xLmluamVjdCh0eXBlc180LklTZXJ2aWNlQ29udGFpbmVyKSlcbl0sIExpbnRpbmdFbmdpbmUpO1xuZXhwb3J0cy5MaW50aW5nRW5naW5lID0gTGludGluZ0VuZ2luZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxpbnRpbmdFbmdpbmUuanMubWFwIl19
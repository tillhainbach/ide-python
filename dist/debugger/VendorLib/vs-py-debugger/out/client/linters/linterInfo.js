"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const path = require("path");

const types_1 = require("../common/types");

class LinterInfo {
  constructor(product, id, configService, configFileNames = []) {
    this.configService = configService;
    this._product = product;
    this._id = id;
    this._configFileNames = configFileNames;
  }

  get id() {
    return this._id;
  }

  get product() {
    return this._product;
  }

  get pathSettingName() {
    return `${this.id}Path`;
  }

  get argsSettingName() {
    return `${this.id}Args`;
  }

  get enabledSettingName() {
    return `${this.id}Enabled`;
  }

  get configFileNames() {
    return this._configFileNames;
  }

  enableAsync(enabled, resource) {
    return __awaiter(this, void 0, void 0, function* () {
      return this.configService.updateSetting(`linting.${this.enabledSettingName}`, enabled, resource);
    });
  }

  isEnabled(resource) {
    const settings = this.configService.getSettings(resource);
    return settings.linting[this.enabledSettingName];
  }

  pathName(resource) {
    const settings = this.configService.getSettings(resource);
    return settings.linting[this.pathSettingName];
  }

  linterArgs(resource) {
    const settings = this.configService.getSettings(resource);
    const args = settings.linting[this.argsSettingName];
    return Array.isArray(args) ? args : [];
  }

  getExecutionInfo(customArgs, resource) {
    const execPath = this.pathName(resource);
    const args = this.linterArgs(resource).concat(customArgs);
    let moduleName; // If path information is not available, then treat it as a module,

    if (path.basename(execPath) === execPath) {
      moduleName = execPath;
    }

    return {
      execPath,
      moduleName,
      args,
      product: this.product
    };
  }

}

exports.LinterInfo = LinterInfo;

class PylintLinterInfo extends LinterInfo {
  constructor(configService, workspaceService, configFileNames = []) {
    super(types_1.Product.pylint, 'pylint', configService, configFileNames);
    this.workspaceService = workspaceService;
  }

  isEnabled(resource) {
    const enabled = super.isEnabled(resource);

    if (!enabled || this.configService.getSettings(resource).jediEnabled) {
      return enabled;
    } // If we're using new LS, then by default Pylint is disabled (unless the user provides a value).


    const inspection = this.workspaceService.getConfiguration('python.linting', resource).inspect('pylintEnabled');

    if (!inspection || inspection.globalValue === undefined && inspection.workspaceFolderValue === undefined || inspection.workspaceValue === undefined) {
      return false;
    }

    return enabled;
  }

}

exports.PylintLinterInfo = PylintLinterInfo;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpbnRlckluZm8uanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInBhdGgiLCJyZXF1aXJlIiwidHlwZXNfMSIsIkxpbnRlckluZm8iLCJjb25zdHJ1Y3RvciIsInByb2R1Y3QiLCJpZCIsImNvbmZpZ1NlcnZpY2UiLCJjb25maWdGaWxlTmFtZXMiLCJfcHJvZHVjdCIsIl9pZCIsIl9jb25maWdGaWxlTmFtZXMiLCJwYXRoU2V0dGluZ05hbWUiLCJhcmdzU2V0dGluZ05hbWUiLCJlbmFibGVkU2V0dGluZ05hbWUiLCJlbmFibGVBc3luYyIsImVuYWJsZWQiLCJyZXNvdXJjZSIsInVwZGF0ZVNldHRpbmciLCJpc0VuYWJsZWQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibGludGluZyIsInBhdGhOYW1lIiwibGludGVyQXJncyIsImFyZ3MiLCJBcnJheSIsImlzQXJyYXkiLCJnZXRFeGVjdXRpb25JbmZvIiwiY3VzdG9tQXJncyIsImV4ZWNQYXRoIiwiY29uY2F0IiwibW9kdWxlTmFtZSIsImJhc2VuYW1lIiwiUHlsaW50TGludGVySW5mbyIsIndvcmtzcGFjZVNlcnZpY2UiLCJQcm9kdWN0IiwicHlsaW50IiwiamVkaUVuYWJsZWQiLCJpbnNwZWN0aW9uIiwiZ2V0Q29uZmlndXJhdGlvbiIsImluc3BlY3QiLCJnbG9iYWxWYWx1ZSIsInVuZGVmaW5lZCIsIndvcmtzcGFjZUZvbGRlclZhbHVlIiwid29ya3NwYWNlVmFsdWUiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFR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Q0g7O0FBaEJxQzs7QUFrQjFDakIsT0FBTyxDQUFDbUMsZ0JBQVIsR0FBMkJBLGdCQUEzQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL3R5cGVzXCIpO1xuY2xhc3MgTGludGVySW5mbyB7XG4gICAgY29uc3RydWN0b3IocHJvZHVjdCwgaWQsIGNvbmZpZ1NlcnZpY2UsIGNvbmZpZ0ZpbGVOYW1lcyA9IFtdKSB7XG4gICAgICAgIHRoaXMuY29uZmlnU2VydmljZSA9IGNvbmZpZ1NlcnZpY2U7XG4gICAgICAgIHRoaXMuX3Byb2R1Y3QgPSBwcm9kdWN0O1xuICAgICAgICB0aGlzLl9pZCA9IGlkO1xuICAgICAgICB0aGlzLl9jb25maWdGaWxlTmFtZXMgPSBjb25maWdGaWxlTmFtZXM7XG4gICAgfVxuICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lkO1xuICAgIH1cbiAgICBnZXQgcHJvZHVjdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2R1Y3Q7XG4gICAgfVxuICAgIGdldCBwYXRoU2V0dGluZ05hbWUoKSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmlkfVBhdGhgO1xuICAgIH1cbiAgICBnZXQgYXJnc1NldHRpbmdOYW1lKCkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5pZH1BcmdzYDtcbiAgICB9XG4gICAgZ2V0IGVuYWJsZWRTZXR0aW5nTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuaWR9RW5hYmxlZGA7XG4gICAgfVxuICAgIGdldCBjb25maWdGaWxlTmFtZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb25maWdGaWxlTmFtZXM7XG4gICAgfVxuICAgIGVuYWJsZUFzeW5jKGVuYWJsZWQsIHJlc291cmNlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWdTZXJ2aWNlLnVwZGF0ZVNldHRpbmcoYGxpbnRpbmcuJHt0aGlzLmVuYWJsZWRTZXR0aW5nTmFtZX1gLCBlbmFibGVkLCByZXNvdXJjZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpc0VuYWJsZWQocmVzb3VyY2UpIHtcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MocmVzb3VyY2UpO1xuICAgICAgICByZXR1cm4gc2V0dGluZ3MubGludGluZ1t0aGlzLmVuYWJsZWRTZXR0aW5nTmFtZV07XG4gICAgfVxuICAgIHBhdGhOYW1lKHJlc291cmNlKSB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldFNldHRpbmdzKHJlc291cmNlKTtcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzLmxpbnRpbmdbdGhpcy5wYXRoU2V0dGluZ05hbWVdO1xuICAgIH1cbiAgICBsaW50ZXJBcmdzKHJlc291cmNlKSB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldFNldHRpbmdzKHJlc291cmNlKTtcbiAgICAgICAgY29uc3QgYXJncyA9IHNldHRpbmdzLmxpbnRpbmdbdGhpcy5hcmdzU2V0dGluZ05hbWVdO1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShhcmdzKSA/IGFyZ3MgOiBbXTtcbiAgICB9XG4gICAgZ2V0RXhlY3V0aW9uSW5mbyhjdXN0b21BcmdzLCByZXNvdXJjZSkge1xuICAgICAgICBjb25zdCBleGVjUGF0aCA9IHRoaXMucGF0aE5hbWUocmVzb3VyY2UpO1xuICAgICAgICBjb25zdCBhcmdzID0gdGhpcy5saW50ZXJBcmdzKHJlc291cmNlKS5jb25jYXQoY3VzdG9tQXJncyk7XG4gICAgICAgIGxldCBtb2R1bGVOYW1lO1xuICAgICAgICAvLyBJZiBwYXRoIGluZm9ybWF0aW9uIGlzIG5vdCBhdmFpbGFibGUsIHRoZW4gdHJlYXQgaXQgYXMgYSBtb2R1bGUsXG4gICAgICAgIGlmIChwYXRoLmJhc2VuYW1lKGV4ZWNQYXRoKSA9PT0gZXhlY1BhdGgpIHtcbiAgICAgICAgICAgIG1vZHVsZU5hbWUgPSBleGVjUGF0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBleGVjUGF0aCwgbW9kdWxlTmFtZSwgYXJncywgcHJvZHVjdDogdGhpcy5wcm9kdWN0IH07XG4gICAgfVxufVxuZXhwb3J0cy5MaW50ZXJJbmZvID0gTGludGVySW5mbztcbmNsYXNzIFB5bGludExpbnRlckluZm8gZXh0ZW5kcyBMaW50ZXJJbmZvIHtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWdTZXJ2aWNlLCB3b3Jrc3BhY2VTZXJ2aWNlLCBjb25maWdGaWxlTmFtZXMgPSBbXSkge1xuICAgICAgICBzdXBlcih0eXBlc18xLlByb2R1Y3QucHlsaW50LCAncHlsaW50JywgY29uZmlnU2VydmljZSwgY29uZmlnRmlsZU5hbWVzKTtcbiAgICAgICAgdGhpcy53b3Jrc3BhY2VTZXJ2aWNlID0gd29ya3NwYWNlU2VydmljZTtcbiAgICB9XG4gICAgaXNFbmFibGVkKHJlc291cmNlKSB7XG4gICAgICAgIGNvbnN0IGVuYWJsZWQgPSBzdXBlci5pc0VuYWJsZWQocmVzb3VyY2UpO1xuICAgICAgICBpZiAoIWVuYWJsZWQgfHwgdGhpcy5jb25maWdTZXJ2aWNlLmdldFNldHRpbmdzKHJlc291cmNlKS5qZWRpRW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGVuYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgd2UncmUgdXNpbmcgbmV3IExTLCB0aGVuIGJ5IGRlZmF1bHQgUHlsaW50IGlzIGRpc2FibGVkICh1bmxlc3MgdGhlIHVzZXIgcHJvdmlkZXMgYSB2YWx1ZSkuXG4gICAgICAgIGNvbnN0IGluc3BlY3Rpb24gPSB0aGlzLndvcmtzcGFjZVNlcnZpY2UuZ2V0Q29uZmlndXJhdGlvbigncHl0aG9uLmxpbnRpbmcnLCByZXNvdXJjZSkuaW5zcGVjdCgncHlsaW50RW5hYmxlZCcpO1xuICAgICAgICBpZiAoIWluc3BlY3Rpb24gfHwgaW5zcGVjdGlvbi5nbG9iYWxWYWx1ZSA9PT0gdW5kZWZpbmVkICYmIGluc3BlY3Rpb24ud29ya3NwYWNlRm9sZGVyVmFsdWUgPT09IHVuZGVmaW5lZCB8fCBpbnNwZWN0aW9uLndvcmtzcGFjZVZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZW5hYmxlZDtcbiAgICB9XG59XG5leHBvcnRzLlB5bGludExpbnRlckluZm8gPSBQeWxpbnRMaW50ZXJJbmZvO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGludGVySW5mby5qcy5tYXAiXX0=